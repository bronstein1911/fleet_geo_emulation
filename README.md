# fleet_geo_emulation
скрипт для автоматического проигрывания маршрутов в fleet. Создает маршрут (опционально), отправляет гео через сокет по заданному маршруту в Traccar для эмуляции движения транспортного средства.

## Что делает

- Получает маршруты из API
- Создает тестовые маршруты (опционально)
- Извлекает координаты из маршрута
- Отправляет гео точки в траккар с заданной скоростью и интервалом
- Эмулирует реалистичное движение по маршруту

## Требования

- Python 3.7+
- Доступ к API chirp.kantegory.me, аккаунт клиента с возможностью создавать маршруты

## зависимости

```bash
pip3 install requests
```

## Использование

```bash
python3 auto_route_player.py
```

### использование

1. **Введите токен Chirp** - devtools -> storage -> cookies -> забираем токен ("eyJh...")
2. **выбираем маршрут**:
   - `y` - создать новый тестовый маршрут в Москве
   - `n` - использовать существующий маршрут (покажет список существующих)
3. **Скрипт автоматически**:
   - Найдет устройство с uniqueId в маршруте
   - Извлечет координаты из planned_route
   - Отправит точки в Traccar с настройками по умолчанию

### Параметры по умолчанию

- **Скорость**: 40 км/ч
- **Интервал**: 0.5 секунды между точками
- **Источник координат**: planned_route
- **Режим**: полный маршрут (от точки A до точки B)
- **Финализация**: остановка в конечной точке

## Конфигурация

Основные настройки в классе `Config`:

```python
CHIRP_BASE = "https://chirp.kantegory.me/api/geo"
DM_BASE = "https://chirp.kantegory.me/api/device-management" 
TRACCAR_OSMAND = "http://89.104.68.209:5055/"
DEFAULT_SPEED_KMH = 40.0
DEFAULT_INTERVAL_S = 0.5
```

## Архитектура

### Ключевые функции

- `get_route_first_device_unique_id()` - получение uniqueId устройства
- `extract_planned_or_steps()` - извлечение координат из маршрута
- `send_osmand()` - отправка точки в Traccar
- `execute_route_playback()` - выполнение проигрывания

## Примеры использования

### Создание тестового маршрута

```
bearer токен chirp.kantegory.me: your_token_here
создать небольшой маршрут в Москве и использовать его? [y/N]: y
device_id для маршрута (свободный): 1234
имя маршрута (по умолчанию 'test route'): Test Route
описание (по умолчанию 'test route'): Test Description
```

### Использование существующего маршрута

```
bearer токен chirp.kantegory.me: your_token_here
создать небольшой маршрут в Москве и использовать его? [y/N]: n

доступные маршруты:
id      status      dist(km)    devices name
618     in_progress 24.6        1316:-  test zavr
616     done        3.5         1343:-  Warehouse route

введи route id, который проигрывать: 618
```

## Выходные данные

 выводит информацию об отправленных точках:

```
uniqueId=ABC123, sending 45 точек
#1/45 55.755800,37.617600 -> 200
#2/45 55.755850,37.617650 -> 200
...
#final B 55.755900,37.617700 (stop) -> 200
done
```

## Обработка ошибок

- Проверка валидности токена
- Проверка наличия устройства с uniqueId
- Проверка наличия координат в маршруте
- Обработка сетевых ошибок

## Ограничения

- Работает только с маршрутами, содержащими устройства с uniqueId
- Требует доступ к Traccar серверу
- Тестовые маршруты создаются только в пределах Москвы

## возможные проблемы

При возникновении проблем проверьте:
1. Корректность bearer токена
2. Доступность API Chirp
3. Доступность Traccar сервера
4. Наличие устройства с uniqueId в маршруте
